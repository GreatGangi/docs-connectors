= Salesforce - Upgrade and Migrate - Mule 4
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:imagesdir: ../../assets/images/

Upgrade Anypoint Connector for Salesforce (Salesforce Connector) to version 10.0.0.

== Supported Upgrade Paths

[%header,cols="50a,50a"]
|===
|From Version | To Version
|9.8.x |10.0.0
|===

== Changes in This Release

This release contains the following changes:

* Removed deprecated connection providers
* Merged multiple operations in one
* Replay ID functionality re-designed
* Mule TLSContext's usage
* Dozer library removal
* Improved error types


== Changes in Connection Providers

In matter of connection providers, this release contains the following changes:

* Removed the deprecated connection providers (the ones that were using pooling connection) from the previous version.
* Added new tabs in Salesforce Config and reordered the parameters in a more intuitive way.
* Added Connection Pool Config tab to improve multi-threading support while running operations. This contains 3 parameters that
help the user manage the connection objects of the application.This is also needed because of some limitations of the Salesforce
WSC library used by the connector - when operations are executed in the same time, the headers for the operation might have been
overridden with wrong values. With the addition of the Connection Pool, each request sent to the API has its own headers and
read timeout.
* Read timeout parameter was removed from the provider's configuration and now it can be find in the connector's
configuration. It has a default value of 0 seconds, which means infinite, and it can be overridden in any operation via
the Advanced tab.
* Some parameters were removed: _Advanced reconnection params_,
_Assigment rule id_,
_Client id_,
_Time object store_,
_Batch SObject max depth_,
_Disable session invalidation_,
_Allow field truncation support_,
_Use default rule_,
_Can clear fields by updating field value to null_.

== Changes in Operations Parameters and Return Types

[cols="5%,30%,20%,20%, 20%"]
|===
|Nr |Operation |Input parameters |Return type (Salesforce 9) |Return type (Salesforce 10)

|1
|Abort job
|+ Read timeout

+ Time unit
|Nothing changed |-

|2
|Abort job bulk api v2 (in previous version was called _Abort job v2_)
|+ Read timeout

+ Time unit
|Nothing changed |-

|3
|Abort query job bulk api v2 (in previous version was called _Abort query job_)
|+ Id (in previous version was called _Query job id_)

+ Read timeout

+ Time unit
|Nothing changed |-

|4
|Batch info
|+ Read timeout

+ Time unit
|Nothing changed |-

|5
|Batch info list
|+ Read timeout

+ Time unit
|Nothing changed |-

|6
|Batch result
|+ Read timeout

+ Time unit
|BatchResult containing the info about the batch processing result
|BulkOperationResult so it can be integrated with the Batch Scope - also containing the details about the processing result

|7
|Batch result stream
|+ Read timeout

+ Time unit
|BulkOperationResult containing the returned InputStream
|InputStream

|8
|Change own password
|+ Read timeout

+ Time unit
|Nothing changed |-

|9
|Close job
|+ Read timeout

+ Time unit
|Nothing changed |-

|10
|Convert lead
|+ Read timeout

+ Time unit
|Nothing changed |-

|11
|Create
|+ Read timeout

+ Time unit
|A list of results
|BulkOperationResult containing the result

|12
|Create batch
|+ Read timeout

+ Time unit
|Nothing changed |-

|13
|Create batch for query
|+ Headers

+ Read timeout

+ Time unit
|Nothing changed |-

|14
|Create batch stream
|+ Read timeout

+ Time unit
|Nothing changed |-

|15
|Create job
|+ Read timeout

+ Time unit
|Nothing changed |-

|16
|Create job bulk api v2
|+ Read timeout

+ Time unit

- Content type
|Nothing changed |-

|17
|Create metadata
|+ Read timeout

+ Time unit
|Nothing changed |-

|18
|Create query job bulk api v2
|+ Read timeout

+ Time unit

- Object
|Nothing changed |-

|19
|Delete
|+ Read timeout

+ Time unit

|A list of results
|BulkOperationResult containing the result

|20
|Delete job bulk api v2
|+ Read timeout

+ Time unit
|Nothing changed |-

|21
|Delete metadata
|+ Headers

+ Read timeout

+ Time unit
|Nothing changed |-

|22
|Delete query job bulk api v2
|+ Read timeout

+ Time unit
|Nothing changed |-

|23
|Deploy metadata
|+ Headers

+ Read timeout

+ Time unit
|Nothing changed |-

|24
|Describe global
|+ Read timeout

+ Time unit
|Nothing changed |-

|25
|Describe metadata
|+ Headers

+ Read timeout

+ Time unit
|Nothing changed |-

|26
|Describe sobject
|+ Headers

+ Read timeout

+ Time unit
|Nothing changed |-

|27
|Find duplicates
|+ Read timeout

+ Time unit
|Nothing changed |-

|28
|Find duplicates by ids
|+Ids List (in previous version was called _List of object ids used when searching for duplicates_)

+ Read timeout

+ Time unit
|Nothing changed |-

|29
|Get all jobs bulk api v2 (in previous version was called _Get all jobs v2_)
|+ Pk Chunking (in previous version was called _Is pk chunking enabled_)

+ Read timeout

+ Time unit
|Nothing changed |-

|30
|Get all query jobs bulk api v2 (in previuos version was called _Get all query jobs_)
|+ Pk Chunking (in previous version was called _Is pk chunking enabled_)

+ Read timeout

+ Time unit
|Nothing changed |-

|31
|Get deleted
|- Duration(_Duration_ parameter was replaced by _Start date_ and _End date_ parameters)

+ Object type (in previous version was called _Type_)

+ Start date

+ End date

+ Read timeout

+ Time unit
| Nothing changed |

|32
|Get job state bulk api v2 (in previous version was called _Get bulk job state bulk v 2_)
|+ Read timeout

+ Time unit
|Nothing changed |-

|33
|Get query job info bulk api v2 (in previous version was called _Get query job info_)
|+Id (in previous version was called _Query job id_)

+ Read timeout

+ Time unit
|Nothing changed |-

|34
|Get query job result bulk api v2 (in previous version was called _Get query job result_)
|+Id (in previous version was called _Query job id_)

+ Read timeout

+ Time unit
|Nothing changed |-

|35
|Get server timestamp
|+ Read timeout

+ Time unit
|Nothing changed |-

|36
|Get updated objects (in previous version was called _Get updated_)
|- Duration(_Duration_ parameter was replaced by _Start date_ and _End date_ parameters)

+ Object type (in previous version was called _Type_)

+ Start date

+ End date

+ Read timeout

+ Time unit
|Nothing changed |-

|37
|Get user info
|+ Read timeout

+ Time unit
|Nothing changed |-

|38
|Invoke apex rest method
|+ Read timeout

+ Time unit
|Nothing changed |-

|39
|Invoke apex soap method
|+ Read timeout

+ Time unit
|Nothing changed |-

|40
|Job info
|+ Read timeout

+ Time unit
|Nothing changed |-

|41
|List metadata
|+ Headers

+ Read timeout

+ Time unit
|Nothing changed |-

|42
|Merge
|+ Read timeout

+ Time unit
|Nothing changed |-

|43
|Publish platform event message
|+ Read timeout

+ Time unit
|Nothing changed |-

|44
|Publish streaming channel
|+ Read timeout

+ Time unit
|Nothing changed |-

|45
|Publish topic
|+ Read timeout

+ Time unit
|Nothing changed |-

|46
|Push generic event
|+ Read timeout

+ Time unit
|Nothing changed |-

|47
|Query
|+ Read timeout

+ Time unit
|Nothing changed |-

|48
|Query all
|+ Read timeout

+ Time unit
|Nothing changed |-

|49
|Query result stream
|+ Read timeout

+ Time unit
|Nothing changed |-

|50
|Read metadata
|+ Read timeout

+ Time unit
|Nothing changed |-

|51
|Rename metadata
|+ Headers

+ Read timeout

+ Time unit
|Nothing changed |-

|52
|Reset password
|+ Read timeout

+ Time unit
|Nothing changed |-

|53
|Retrieve
|+ Read timeout

+ Time unit
|Nothing changed |-

|54
|Retrieve job failed result bulk v2 (in previous version was called _Retrieve record failure bulk v 2_)
|+ Read timeout

+ Time unit
|Nothing changed |-

|55
|Retrieve job successful result bulk v2 (in previous version was called _Retrieve record success bulk v 2_)
|+ Read timeout

+ Time unit
|Nothing changed |-

|56
|Retrieve metadata
|+ Read timeout

+ Time unit
|Nothing changed |-

|57
|Search
|+ Read timeout

+ Time unit
|Nothing changed |-

|58
|Set password
|+ Read timeout

+ Time unit
|Nothing changed |-

|59
|Unauthorize
|+ Read timeout

+ Time unit
|Nothing changed |-

|60
|Update
|+ Read timeout

+ Time unit
|A list of results
|BulkOperationResult containing the result

|61
|Update metadata
|+ Headers

+ Read timeout

+ Time unit
|Nothing changed |-

|62
|Upsert
|+ Object type (in previous version was called _Type_)

+ Read timeout

+ Time unit
|Nothing changed |-

|63
|Upsert metadata
|+ Headers

+ Read timeout

+ Time unit
|Nothing changed |-
|===

== Changes in Operations Metadata

There are no changes related to keys, input/output metadata.

== Removed Operations in Salesforce Connector 10.0.0

Four operations were removed from the Salesforce connector and are available in the new connector.

//[cols="15%,35%,15%]
|===
3+|Removed in Salesforce 10.x
|Name	|Reason for removal|Functionality covered by

| Create single | The Create operation can be used with a single record if needed. |Create
| Create multiple | This operation was returning a BulkOperationResult in order to be integrated with the Batch scope, but now the Create operation returns the same type. |Create
| Create bulk | This operation makes no sense as it simple creates a job with a certain operation and afterwards it uploads a batch in that job. | Create Job with INSERT operation parameter + Create Batch
| Update single	| The Update operation can be used with a single record if needed.| Update
| Update multiple | This operation was returning a BulkOperationResult in order to be integrated with the Batch scope, but now the Update operation returns the same type. |Update
| Update bulk | This operation makes no sense as it simple creates a job with a certain operation and afterwards it uploads a batch in that job. | Create Job with UPDATE operation parameter + Create Batch
| Upsert multiple | This operation was returning a BulkOperationResult in order to be integrated with the Batch scope, but now the Upsert operation returns the same type. |Upsert
| Upsert bulk | This operation makes no sense as it simple creates a job with a certain operation and afterwards it uploads a batch in that job. | Create Job with UPSERT operation parameter + Create Batch
| Delete multiple | This operation was returning a BulkOperationResult in order to be integrated with the Batch scope, but now the Update operation returns the same type. |Delete
| Hard delete bulk | This operation makes no sense as it simple creates a job with a certain operation and afterwards it uploads a batch in that job. | Create Job with HARD DELETE operation parameter + Create Batch
| Query single | The Query operation can be used to return a single entity by using LIMIT 1.| Query
| Non paginated query | The runtime already returns all the results for the Query operation so this operation is not useful. | Query
| Get updated objects | This operation was removed since the initialTimeWindow parameter did not made much sense. | Get updated objects + Retrieve
| Get updated | This operation was removed since it was providing the same functionality as Get Updated Range operation with some small differences in input parameters. | Get updated objects
| Get deleted range | This operation was removed as it made not much sense since it was providing the same functionality as Get Deleted with some small differences in input parameters. | Get deleted objects
| Create bulk for query | This operation was returning a BulkOperationResult but it makes no sense to integrate it with the Batch Scope since it only returns a single result | Create batch for query
| Create multiple bulk | This operation was returning a BulkOperationResult but it makes no sense to integrate it with the Batch Scope since it only returns a single result | Create Job with CREATE operation parameter + Create Batch
| Update multiple bulk | This operation was returning a BulkOperationResult but it makes no sense to integrate it with the Batch Scope since it only returns a single result | Create Job with UPDATE operation parameter + Create Batch
| Upsert multiple bulk | This operation was returning a BulkOperationResult but it makes no sense to integrate it with the Batch Scope since it only returns a single result | Create Job with UPSERT operation parameter + Create Batch
| Hard delete multiple | This operation was returning a BulkOperationResult but it makes no sense to integrate it with the Batch Scope since it only returns a single result | Create Job with HARD DELETE operation parameter + Create Batch
| Create multiple batch | This operation was returning a BulkOperationResult but it makes no sense to integrate it with the Batch Scope since it only returns a single result| Create batch
| Create multiple batch stream |  This operation was returning a BulkOperationResult but it makes no sense to integrate it with the Batch Scope since it only returns a single result| Create batch stream
| Bulk result | This operation was returning a BulkOperationResult but it makes no sense to integrate it with the Batch Scope since it only returns a single result.| Batch result
| Bulk result stream| This operation was returning a BulkOperationResult but it makes no sense to integrate it with the Batch Scope since it only returns a single result. Now the Batch result stream operation returns an input stream that can be split into batches and processed using the Batch scope if desired. |Batch result stream
| Bulk info | This operation was returning a BulkOperationResult but it makes no sense to integrate it with the Batch Scope since it only returns a single result| Batch info
| Query multiple result stream | This operation was returning a BulkOperationResult but it makes no sense to integrate it with the Batch Scope since it only returns a single result. Now the Query result stream operation returns an input stream that can be split into batches and processed using the Batch scope if desired.| Query result stream
| Bulk info list | This operation was returning a BulkOperationResult but it makes no sense to be integrated with the Batch Scope. | Batch info list
|===

=== Changes to Operations and Sources Names

Some of the operations names are updated:

|===
|9.8.x|10.0.0

|Abort job v2
|Abort job bulk api v2

|Abort query job
|Abort query job bulk api v2

|Get all jobs v2
|Get all jobs bulk api v2

|Get all query jobs
|Get all query jobs bulk api v2

|Get bulk job state bulk v 2
|Get job state bulk api v2

|Get query job info
|Get query job info bulk api v2

|Get query job result
|Get query job result bulk api v2

|Get updated
|Get updated objects

|Retrieve record failure bulk v 2
|Retrieve job failed result bulk v2

|Retrieve record success bulk v 2
|Retrieve job successful result bulk v2

|Replay channel
|Replay channel listener

|Replay topic
|Replay topic listener
|===

== Upgrade Steps

. Create a backup of your files, data, and configuration in case you need to restore to the previous version.
. Follow these steps to perform the upgrade to Salesforce Connector 10.0.0:

.. In Studio, create a Mule project.
.. In the Mule Palette view, click *Search in Exchange*.
.. In Add Modules to Project, type 'Salesforce 10' in the search field.
.. In Available modules, select *Salesforce Connector 10.0.0*, and then click *Add*.
.. Click *Finish*.
.. Verify that the `salesforce-connector` dependency version is `10.0.0` in the pom.xml.

Anypoint Studio upgrades the connector automatically.


== Verify the Upgrade

After you install the latest version of the connector, follow these steps to verify the upgrade:

. In Anypoint Studio, verify that there are no errors in the *Problems* or *Console* views.
. Check the project pom.xml and verify that there are no problems.
. Test the connection and verify that the operations work.

== Troubleshooting

If there are problems with caching the parameters and caching the metadata, try restarting Anypoint Studio.

== Reverting the Upgrade

If it is necessary to revert to the previous version of Salesforce Connector, change the `salesforce-connector` dependency version `10.0.0` in the project's pom.xml to the previous version.

You must update the project's pom.xml in Anypoint Studio.


== See Also

https://help.mulesoft.com[MuleSoft Help Center]
